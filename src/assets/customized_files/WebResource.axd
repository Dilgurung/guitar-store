var epiRecommendations=function(settings){return{track:function(trackingData,scope,channel,onSuccess,callbackOptions){if(typeof settings==="undefined"){return}trackingData.scope=(typeof scope==="undefined")?null:scope;trackingData.channel=(typeof channel==="undefined")?null:channel;this._sendTrackingData(trackingData,onSuccess,callbackOptions)},_sendTrackingData:function(trackingData,onSuccess,callbackOptions){var proxyUrl=settings.endPointUrl;if(!proxyUrl||this._isEmpty(trackingData)){return}if(!trackingData.lang){trackingData.lang=settings.preferredCulture}this._post(proxyUrl,JSON.stringify(trackingData),function(response){try{var data=JSON.parse(response);if(data.errors){console.info(data.errors);return}}catch(err){console.info(err.message)}typeof onSuccess==="function"&&onSuccess(response,callbackOptions)})},_isEmpty:function(obj){return obj===undefined||obj===null||(Object.keys(obj).length===0&&obj.constructor===Object)},_post:function(url,data,onSuccess,async){this._send("POST",url,data,onSuccess,async)},_send:function(method,url,data,onSuccess,async){if(typeof async==="undefined"){async=true}var xhr=this._getXHR();xhr.open(method,url,async);xhr.onreadystatechange=function(){if(xhr.readyState===4&&typeof onSuccess==="function"){onSuccess(xhr.responseText)}};xhr.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr.send(data)},_getXHR:function(){if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest()}var vers=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(var i=0,length=vers.length;i<length;i++){try{return new ActiveXObject(vers[i])}catch(err){console.info(err.message)}}return new XMLHttpRequest()}}};var TrackingDataFactory={createHomeTrackingData:function(){return this._createTrackingDataBase("home")},createProductTrackingData:function(productCode,productName){var trackingData=this._createTrackingDataBase("product");trackingData.productCode=productCode;trackingData.contentName=productName;return trackingData},createSearchResultTrackingData:function(term,productCodes,totalResultCount){var trackingData=this._createTrackingDataBase("searchresults");trackingData.searchResults={term:term,productCodes:productCodes,totalNumberOfResults:totalResultCount};return trackingData},createCheckoutTrackingData:function(){return this._createTrackingDataBase("checkout")},createBasketTrackingData:function(){var basketTracking=this._createTrackingDataBase("basket");basketTracking.skipRecommendations=true;return basketTracking},createOrderTrackingData:function(orderId){var orderTrackingData=this._createTrackingDataBase("order");orderTrackingData.orderId=orderId;return orderTrackingData},createBrandTrackingData:function(brandName){var trackingData=this._createTrackingDataBase("brand");trackingData.brand=brandName;return trackingData},createCategoryTrackingData:function(categoryCode){var trackingData=this._createTrackingDataBase("category");trackingData.category=categoryCode;return trackingData},createAttributeTrackingData:function(attributeName,attributeValue){var trackingData=this._createTrackingDataBase("attribute");trackingData.attribute={name:attributeName,value:attributeValue};return trackingData},createWishlistTrackingData:function(){return this._createTrackingDataBase("wishlist")},_createTrackingDataBase:function(type){return{type:type,currentUri:window.location.href,previousUri:document.referrer,customAttributes:{}}}};